generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider  = "postgresql"
  url       = env("POSTGRES_PRISMA_URL") // Uses connection pooling
  directUrl = env("POSTGRES_URL_NON_POOLING") // Uses direct connection
}

model User {
  id            String   @id @default(cuid())
  email         String   @unique
  steamId       String?  @unique
  createdAt     DateTime @default(now())
  library       UserLibrary[]
}

model Game {
  id                String   @id // ID externe (IGDB ou Steam généré)
  title             String
  coverUrl          String?
  releaseDate       DateTime?
  hltbMain          Int?     // En minutes
  hltbExtra         Int?
  hltbCompletionist Int?
  users             UserLibrary[]
}

model UserLibrary {
  id             String   @id @default(cuid())
  userId         String
  gameId         String
  status         String   @default("BACKLOG") // BACKLOG, PLAYING, COMPLETED, ABANDONED, WISHLIST
  playtimeSteam  Int      @default(0) // En minutes
  playtimeManual Int?     // Override
  user           User     @relation(fields: [userId], references: [id])
  game           Game     @relation(fields: [gameId], references: [id])

  @@unique([userId, gameId])
}
